<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
<sqlMap namespace="t_contract_infor">
 <typeAlias alias="contractDto" type="com.tl.resource.business.dto.ContractInforDto"/>
 <resultMap class="com.tl.resource.dao.pojo.TContractInfor" id="ibatorgenerated_BaseResultMap">
    <result column="id" jdbcType="VARCHAR" property="id" />
    <result column="contract_code" jdbcType="VARCHAR" property="contractCode" />
    <result column="seller_name" jdbcType="VARCHAR" property="sellerName" />
    <result column="currency_id" jdbcType="VARCHAR" property="currencyId" />
    <result column="currency_name" jdbcType="VARCHAR" property="currencyName" />
    <result column="sign_date" jdbcType="VARCHAR" property="signDate" />
    <result column="urgent_level" jdbcType="DECIMAL" property="urgentLevel" />
    <result column="customer_code" jdbcType="VARCHAR" property="customerCode" />
    <result column="customer_name" jdbcType="VARCHAR" property="customerName" />
    <result column="status" jdbcType="INTEGER" property="status" />
    <result column="sign_address" jdbcType="VARCHAR" property="signAddress" />
    <result column="reference" jdbcType="VARCHAR" property="reference" />
    <result column="traffic_mode" jdbcType="VARCHAR" property="trafficMode" />
    <result column="closing_account_mode_id" jdbcType="DECIMAL" property="closingAccountModeId" />
    <result column="closing_account_mode" jdbcType="VARCHAR" property="closingAccountMode" />
    <result column="delivery_address_type" jdbcType="VARCHAR" property="deliveryAddressType" />
    <result column="other_convention" jdbcType="VARCHAR" property="otherConvention" />
    <result column="effect_conditions" jdbcType="VARCHAR" property="effectConditions" />
    <result column="product_money" jdbcType="DECIMAL" property="productMoney" />
    <result column="tax_rate" jdbcType="DECIMAL" property="taxRate" />
    <result column="tax_money" jdbcType="DECIMAL" property="taxMoney" />
    <result column="total_money" jdbcType="DECIMAL" property="totalMoney" />
    <result column="overall_rebate" jdbcType="DECIMAL" property="overallRebate" />
    <result column="final_money" jdbcType="DECIMAL" property="finalMoney" />
    <result column="memo" jdbcType="VARCHAR" property="memo" />
    <result column="edit_date" jdbcType="TIMESTAMP" property="editDate" />
    <result column="user_id" jdbcType="VARCHAR" property="userId" />
    <result column="user_name" jdbcType="VARCHAR" property="userName" />
    <result column="contract_type" jdbcType="INTEGER" property="contractType" />
    <result column="customer_fax" jdbcType="VARCHAR" property="customerFax" />
    <result column="customer_phone" jdbcType="VARCHAR" property="customerPhone" />
    <result column="own_contact_person" jdbcType="VARCHAR" property="ownContactPerson" />
    <result column="cus_contact_person" jdbcType="VARCHAR" property="cusContactPerson" />
    <result column="exemplar_invoice" jdbcType="INTEGER" property="exemplarInvoice" />
    <result column="invoice_money" jdbcType="DECIMAL" property="invoiceMoney" />
    <result column="return_money" jdbcType="DECIMAL" property="returnMoney" />
    <result column="delivery_money" jdbcType="DECIMAL" property="deliveryMoney" />
  </resultMap>
  <resultMap id="result" class="contractDto" extends="ibatorgenerated_BaseResultMap">
  <result column="file_count" jdbcType="INTEGER" property="fileCount" />
  <result column="cus_lock_status" jdbcType="INTEGER" property="cusLockStatus" />
  </resultMap>
  
  <sql id="ibatorgenerated_Example_Where_Clause">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    <iterate conjunction="or" prepend="where" property="oredCriteria" removeFirstPrepend="iterate">
      <isEqual compareValue="true" property="oredCriteria[].valid">
        (
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithoutValue">
          $oredCriteria[].criteriaWithoutValue[]$
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithSingleValue">
          $oredCriteria[].criteriaWithSingleValue[].condition$
            #oredCriteria[].criteriaWithSingleValue[].value#
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithListValue">
          $oredCriteria[].criteriaWithListValue[].condition$
          <iterate close=")" conjunction="," open="(" property="oredCriteria[].criteriaWithListValue[].values">
            #oredCriteria[].criteriaWithListValue[].values[]#
          </iterate>
        </iterate>
        <iterate conjunction="and" prepend="and" property="oredCriteria[].criteriaWithBetweenValue">
          $oredCriteria[].criteriaWithBetweenValue[].condition$
          #oredCriteria[].criteriaWithBetweenValue[].values[0]# and
          #oredCriteria[].criteriaWithBetweenValue[].values[1]#
        </iterate>
        )
      </isEqual>
    </iterate>
  </sql>
  <select id="ibatorgenerated_selectByExample" parameterClass="com.tl.resource.dao.pojo.TContractInforExample" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    select id, contract_code, seller_name, currency_id, currency_name, sign_date, urgent_level,
      customer_code, customer_name, status, sign_address, reference, traffic_mode,
      closing_account_mode_id, closing_account_mode, delivery_address_type, other_convention,
      effect_conditions, product_money, tax_rate, tax_money, total_money, overall_rebate,
      final_money, memo, edit_date, user_id, user_name, contract_type, customer_fax, customer_phone,
      own_contact_person, cus_contact_person,exemplar_invoice,invoice_money,return_money,delivery_money
    from t_contract_infor
    <isParameterPresent>
      <include refid="t_contract_infor.ibatorgenerated_Example_Where_Clause" />
      <isNotNull property="orderByClause">
        order by $orderByClause$
      </isNotNull>
    </isParameterPresent>
  </select>
  <select id="ibatorgenerated_selectByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TContractInfor" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    select id, contract_code, seller_name, currency_id, currency_name, sign_date, urgent_level,
      customer_code, customer_name, status, sign_address, reference, traffic_mode,
      closing_account_mode_id, closing_account_mode, delivery_address_type, other_convention,
      effect_conditions, product_money, tax_rate, tax_money, total_money, overall_rebate,
      final_money, memo, edit_date, user_id, user_name, contract_type, customer_fax, customer_phone,
      own_contact_person, cus_contact_person,exemplar_invoice,invoice_money,return_money,delivery_money
    from t_contract_infor
    where id = #id:VARCHAR#
  </select>
  <delete id="ibatorgenerated_deleteByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TContractInfor">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    delete from t_contract_infor
    where id = #id:VARCHAR#
  </delete>
  <delete id="ibatorgenerated_deleteByExample" parameterClass="com.tl.resource.dao.pojo.TContractInforExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    delete from t_contract_infor
    <include refid="t_contract_infor.ibatorgenerated_Example_Where_Clause" />
  </delete>
  <insert id="ibatorgenerated_insert" parameterClass="com.tl.resource.dao.pojo.TContractInfor">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    insert into t_contract_infor (id, contract_code, seller_name, currency_id, currency_name,
      sign_date, urgent_level, customer_code, customer_name, status, sign_address, reference,
      traffic_mode, closing_account_mode_id, closing_account_mode, delivery_address_type,
      other_convention, effect_conditions, product_money, tax_rate, tax_money, total_money,
      overall_rebate, final_money, memo, edit_date, user_id, user_name, contract_type, customer_fax,
      customer_phone, own_contact_person, cus_contact_person,exemplar_invoice,invoice_money,return_money,delivery_money)
    values (#id:VARCHAR#, #contractCode:VARCHAR#, #sellerName:VARCHAR#, #currencyId:VARCHAR#,
      #currencyName:VARCHAR#, #signDate:VARCHAR#, #urgentLevel:DECIMAL#, #customerCode:VARCHAR#,
      #customerName:VARCHAR#, #status:INTEGER#, #signAddress:VARCHAR#, #reference:VARCHAR#,
      #trafficMode:VARCHAR#, #closingAccountModeId:DECIMAL#, #closingAccountMode:VARCHAR#,
      #deliveryAddressType:VARCHAR#, #otherConvention:VARCHAR#, #effectConditions:VARCHAR#,
      #productMoney:DECIMAL#, #taxRate:DECIMAL#, #taxMoney:DECIMAL#, #totalMoney:DECIMAL#,
      #overallRebate:DECIMAL#, #finalMoney:DECIMAL#, #memo:VARCHAR#, #editDate:TIMESTAMP#,
      #userId:VARCHAR#, #userName:VARCHAR#, #contractType:INTEGER#, #customerFax:VARCHAR#,
      #customerPhone:VARCHAR#, #ownContactPerson:VARCHAR#, #cusContactPerson:VARCHAR#,
      #exemplarInvoice#,#invoiceMoney:DECIMAL#,#returnMoney:DECIMAL#,#deliveryMoney:DECIMAL#)
  </insert>
  <insert id="ibatorgenerated_insertSelective" parameterClass="com.tl.resource.dao.pojo.TContractInfor">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    insert into t_contract_infor
    <dynamic prepend="(">
      <isNotNull prepend="," property="id">
        id
      </isNotNull>
      <isNotNull prepend="," property="contractCode">
        contract_code
      </isNotNull>
      <isNotNull prepend="," property="sellerName">
        seller_name
      </isNotNull>
      <isNotNull prepend="," property="currencyId">
        currency_id
      </isNotNull>
      <isNotNull prepend="," property="currencyName">
        currency_name
      </isNotNull>
      <isNotNull prepend="," property="signDate">
        sign_date
      </isNotNull>
      <isNotNull prepend="," property="urgentLevel">
        urgent_level
      </isNotNull>
      <isNotNull prepend="," property="customerCode">
        customer_code
      </isNotNull>
      <isNotNull prepend="," property="customerName">
        customer_name
      </isNotNull>
      <isNotNull prepend="," property="status">
        status
      </isNotNull>
      <isNotNull prepend="," property="signAddress">
        sign_address
      </isNotNull>
      <isNotNull prepend="," property="reference">
        reference
      </isNotNull>
      <isNotNull prepend="," property="trafficMode">
        traffic_mode
      </isNotNull>
      <isNotNull prepend="," property="closingAccountModeId">
        closing_account_mode_id
      </isNotNull>
      <isNotNull prepend="," property="closingAccountMode">
        closing_account_mode
      </isNotNull>
      <isNotNull prepend="," property="deliveryAddressType">
        delivery_address_type
      </isNotNull>
      <isNotNull prepend="," property="otherConvention">
        other_convention
      </isNotNull>
      <isNotNull prepend="," property="effectConditions">
        effect_conditions
      </isNotNull>
      <isNotNull prepend="," property="productMoney">
        product_money
      </isNotNull>
      <isNotNull prepend="," property="taxRate">
        tax_rate
      </isNotNull>
      <isNotNull prepend="," property="taxMoney">
        tax_money
      </isNotNull>
      <isNotNull prepend="," property="totalMoney">
        total_money
      </isNotNull>
      <isNotNull prepend="," property="overallRebate">
        overall_rebate
      </isNotNull>
      <isNotNull prepend="," property="finalMoney">
        final_money
      </isNotNull>
      <isNotNull prepend="," property="memo">
        memo
      </isNotNull>
      <isNotNull prepend="," property="editDate">
        edit_date
      </isNotNull>
      <isNotNull prepend="," property="userId">
        user_id
      </isNotNull>
      <isNotNull prepend="," property="userName">
        user_name
      </isNotNull>
      <isNotNull prepend="," property="contractType">
        contract_type
      </isNotNull>
      <isNotNull prepend="," property="customerFax">
        customer_fax
      </isNotNull>
      <isNotNull prepend="," property="customerPhone">
        customer_phone
      </isNotNull>
      <isNotNull prepend="," property="ownContactPerson">
        own_contact_person
      </isNotNull>
      <isNotNull prepend="," property="cusContactPerson">
        cus_contact_person
      </isNotNull>
      <isNotNull prepend="," property="exemplarInvoice">
        exemplar_invoice
      </isNotNull>
      <isNotNull prepend="," property="invoiceMoney">
        invoice_money 
      </isNotNull>
      <isNotNull prepend="," property="returnMoney">
        return_money 
      </isNotNull>
      <isNotNull prepend="," property="deliveryMoney">
        delivery_money 
      </isNotNull>
      )
    </dynamic>
    values
    <dynamic prepend="(">
      <isNotNull prepend="," property="id">
        #id:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractCode">
        #contractCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sellerName">
        #sellerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="currencyId">
        #currencyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="currencyName">
        #currencyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="signDate">
        #signDate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="urgentLevel">
        #urgentLevel:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="customerCode">
        #customerCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerName">
        #customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status">
        #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="signAddress">
        #signAddress:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="reference">
        #reference:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="trafficMode">
        #trafficMode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="closingAccountModeId">
        #closingAccountModeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="closingAccountMode">
        #closingAccountMode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deliveryAddressType">
        #deliveryAddressType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="otherConvention">
        #otherConvention:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="effectConditions">
        #effectConditions:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productMoney">
        #productMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="taxRate">
        #taxRate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="taxMoney">
        #taxMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="totalMoney">
        #totalMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="overallRebate">
        #overallRebate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="finalMoney">
        #finalMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="memo">
        #memo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="editDate">
        #editDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="userId">
        #userId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userName">
        #userName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractType">
        #contractType:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="customerFax">
        #customerFax:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerPhone">
        #customerPhone:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ownContactPerson">
        #ownContactPerson:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cusContactPerson">
        #cusContactPerson:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="exemplarInvoice">
        #exemplarInvoice#
      </isNotNull>
      <isNotNull prepend="," property="invoiceMoney">
        #invoiceMoney#
      </isNotNull>
      <isNotNull prepend="," property="returnMoney">
        #returnMoney#
      </isNotNull>
      <isNotNull prepend="," property="deliveryMoney">
        #deliveryMoney#
      </isNotNull>
      
      )
    </dynamic>
  </insert>
  <select id="ibatorgenerated_countByExample" parameterClass="com.tl.resource.dao.pojo.TContractInforExample" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    select count(*) from t_contract_infor
    <include refid="t_contract_infor.ibatorgenerated_Example_Where_Clause" />
  </select>
  <update id="ibatorgenerated_updateByExampleSelective">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    update t_contract_infor
    <dynamic prepend="set">
      <isNotNull prepend="," property="record.id">
        id = #record.id:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.contractCode">
        contract_code = #record.contractCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.sellerName">
        seller_name = #record.sellerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.currencyId">
        currency_id = #record.currencyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.currencyName">
        currency_name = #record.currencyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.signDate">
        sign_date = #record.signDate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.urgentLevel">
        urgent_level = #record.urgentLevel:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.customerCode">
        customer_code = #record.customerCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.customerName">
        customer_name = #record.customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.status">
        status = #record.status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.signAddress">
        sign_address = #record.signAddress:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.reference">
        reference = #record.reference:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.trafficMode">
        traffic_mode = #record.trafficMode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.closingAccountModeId">
        closing_account_mode_id = #record.closingAccountModeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.closingAccountMode">
        closing_account_mode = #record.closingAccountMode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.deliveryAddressType">
        delivery_address_type = #record.deliveryAddressType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.otherConvention">
        other_convention = #record.otherConvention:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.effectConditions">
        effect_conditions = #record.effectConditions:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.productMoney">
        product_money = #record.productMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.taxRate">
        tax_rate = #record.taxRate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.taxMoney">
        tax_money = #record.taxMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.totalMoney">
        total_money = #record.totalMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.overallRebate">
        overall_rebate = #record.overallRebate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.finalMoney">
        final_money = #record.finalMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="record.memo">
        memo = #record.memo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.editDate">
        edit_date = #record.editDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="record.userId">
        user_id = #record.userId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.userName">
        user_name = #record.userName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.contractType">
        contract_type = #record.contractType:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="record.customerFax">
        customer_fax = #record.customerFax:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.customerPhone">
        customer_phone = #record.customerPhone:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.ownContactPerson">
        own_contact_person = #record.ownContactPerson:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.cusContactPerson">
        cus_contact_person = #record.cusContactPerson:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="record.exemplarInvoice">
         exemplar_invoice = #record.exemplarInvoice#
      </isNotNull>
      
     <isNotNull prepend="," property="record.invoiceMoney">
         invoice_money  = #record.invoiceMoney#
      </isNotNull>
      <isNotNull prepend="," property="record.returnMoney">
         return_money  = #record.returnMoney#
      </isNotNull>
      <isNotNull prepend="," property="record.deliveryMoney">
         delivery_money  = #record.deliveryMoney#
      </isNotNull>
    </dynamic>
    <isParameterPresent>
      <include refid="t_contract_infor.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByExample">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    update t_contract_infor
    set id = #record.id:VARCHAR#,
      contract_code = #record.contractCode:VARCHAR#,
      seller_name = #record.sellerName:VARCHAR#,
      currency_id = #record.currencyId:VARCHAR#,
      currency_name = #record.currencyName:VARCHAR#,
      sign_date = #record.signDate:VARCHAR#,
      urgent_level = #record.urgentLevel:DECIMAL#,
      customer_code = #record.customerCode:VARCHAR#,
      customer_name = #record.customerName:VARCHAR#,
      status = #record.status:INTEGER#,
      sign_address = #record.signAddress:VARCHAR#,
      reference = #record.reference:VARCHAR#,
      traffic_mode = #record.trafficMode:VARCHAR#,
      closing_account_mode_id = #record.closingAccountModeId:DECIMAL#,
      closing_account_mode = #record.closingAccountMode:VARCHAR#,
      delivery_address_type = #record.deliveryAddressType:VARCHAR#,
      other_convention = #record.otherConvention:VARCHAR#,
      effect_conditions = #record.effectConditions:VARCHAR#,
      product_money = #record.productMoney:DECIMAL#,
      tax_rate = #record.taxRate:DECIMAL#,
      tax_money = #record.taxMoney:DECIMAL#,
      total_money = #record.totalMoney:DECIMAL#,
      overall_rebate = #record.overallRebate:DECIMAL#,
      final_money = #record.finalMoney:DECIMAL#,
      memo = #record.memo:VARCHAR#,
      edit_date = #record.editDate:TIMESTAMP#,
      user_id = #record.userId:VARCHAR#,
      user_name = #record.userName:VARCHAR#,
      contract_type = #record.contractType:INTEGER#,
      customer_fax = #record.customerFax:VARCHAR#,
      customer_phone = #record.customerPhone:VARCHAR#,
      own_contact_person = #record.ownContactPerson:VARCHAR#,
      cus_contact_person = #record.cusContactPerson:VARCHAR#,
      exemplar_invoice = #record.exemplarInvoice#,
      invoice_money = #record.invoiceMoney#,
      return_money = #record.returnMoney#,
      delivery_money = #record.deliveryMoney#
      
    <isParameterPresent>
      <include refid="t_contract_infor.ibatorgenerated_Example_Where_Clause" />
    </isParameterPresent>
  </update>
  <update id="ibatorgenerated_updateByPrimaryKeySelective" parameterClass="com.tl.resource.dao.pojo.TContractInfor">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    update t_contract_infor
    <dynamic prepend="set">
      <isNotNull prepend="," property="contractCode">
        contract_code = #contractCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="sellerName">
        seller_name = #sellerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="currencyId">
        currency_id = #currencyId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="currencyName">
        currency_name = #currencyName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="signDate">
        sign_date = #signDate:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="urgentLevel">
        urgent_level = #urgentLevel:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="customerCode">
        customer_code = #customerCode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerName">
        customer_name = #customerName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="status">
        status = #status:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="signAddress">
        sign_address = #signAddress:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="reference">
        reference = #reference:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="trafficMode">
        traffic_mode = #trafficMode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="closingAccountModeId">
        closing_account_mode_id = #closingAccountModeId:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="closingAccountMode">
        closing_account_mode = #closingAccountMode:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="deliveryAddressType">
        delivery_address_type = #deliveryAddressType:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="otherConvention">
        other_convention = #otherConvention:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="effectConditions">
        effect_conditions = #effectConditions:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="productMoney">
        product_money = #productMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="taxRate">
        tax_rate = #taxRate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="taxMoney">
        tax_money = #taxMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="totalMoney">
        total_money = #totalMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="overallRebate">
        overall_rebate = #overallRebate:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="finalMoney">
        final_money = #finalMoney:DECIMAL#
      </isNotNull>
      <isNotNull prepend="," property="memo">
        memo = #memo:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="editDate">
        edit_date = #editDate:TIMESTAMP#
      </isNotNull>
      <isNotNull prepend="," property="userId">
        user_id = #userId:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="userName">
        user_name = #userName:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="contractType">
        contract_type = #contractType:INTEGER#
      </isNotNull>
      <isNotNull prepend="," property="customerFax">
        customer_fax = #customerFax:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="customerPhone">
        customer_phone = #customerPhone:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="ownContactPerson">
        own_contact_person = #ownContactPerson:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="cusContactPerson">
        cus_contact_person = #cusContactPerson:VARCHAR#
      </isNotNull>
      <isNotNull prepend="," property="exemplarInvoice">
        exemplar_invoice = #exemplarInvoice#
      </isNotNull>
      <isNotNull prepend="," property="invoiceMoney">
        invoice_money  = #invoiceMoney#
      </isNotNull>
      <isNotNull prepend="," property="returnMoney">
        return_money  = #returnMoney#
      </isNotNull>
      <isNotNull prepend="," property="deliveryMoney">
        delivery_money  = #deliveryMoney#
      </isNotNull>
      <isNotNull prepend="," property="updateDate">
        update_date = #updateDate:TIMESTAMP#
      </isNotNull>
    </dynamic>
    where id = #id:VARCHAR#
  </update>
  <update id="ibatorgenerated_updateByPrimaryKey" parameterClass="com.tl.resource.dao.pojo.TContractInfor">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Thu Mar 04 17:17:53 CST 2010.
    -->
    update t_contract_infor
    set contract_code = #contractCode:VARCHAR#,
      seller_name = #sellerName:VARCHAR#,
      currency_id = #currencyId:VARCHAR#,
      currency_name = #currencyName:VARCHAR#,
      sign_date = #signDate:VARCHAR#,
      urgent_level = #urgentLevel:DECIMAL#,
      customer_code = #customerCode:VARCHAR#,
      customer_name = #customerName:VARCHAR#,
      status = #status:INTEGER#,
      sign_address = #signAddress:VARCHAR#,
      reference = #reference:VARCHAR#,
      traffic_mode = #trafficMode:VARCHAR#,
      closing_account_mode_id = #closingAccountModeId:DECIMAL#,
      closing_account_mode = #closingAccountMode:VARCHAR#,
      delivery_address_type = #deliveryAddressType:VARCHAR#,
      other_convention = #otherConvention:VARCHAR#,
      effect_conditions = #effectConditions:VARCHAR#,
      product_money = #productMoney:DECIMAL#,
      tax_rate = #taxRate:DECIMAL#,
      tax_money = #taxMoney:DECIMAL#,
      total_money = #totalMoney:DECIMAL#,
      overall_rebate = #overallRebate:DECIMAL#,
      final_money = #finalMoney:DECIMAL#,
      memo = #memo:VARCHAR#,
      edit_date = #editDate:TIMESTAMP#,
      user_id = #userId:VARCHAR#,
      user_name = #userName:VARCHAR#,
      contract_type = #contractType:INTEGER#,
      customer_fax = #customerFax:VARCHAR#,
      customer_phone = #customerPhone:VARCHAR#,
      own_contact_person = #ownContactPerson:VARCHAR#,
      cus_contact_person = #cusContactPerson:VARCHAR#,
      exemplar_invoice = #exemplarInvoice#,
      invoice_money  = #invoiceMoney#,
      return_money  = #returnMoney#,
      delivery_money  = #deliveryMoney#
    where id = #id:VARCHAR#
  </update>

  
  <!--  -->
    <select id="getContractList" parameterClass="java.util.Map" resultClass="java.util.List" resultMap="result">
    	<isEqual property="conType" compareValue="delivery" prepend="">
		SELECT ccc.*,ct.cus_lock_status,(SELECT COUNT(*) FROM t_accessories ac WHERE ac.business_id = ccc.id) file_count  FROM (
					SELECT tci.id, cus.lock_status cus_lock_status
					FROM t_contract_infor tci,t_resource_purview trp,t_customers_infor cus,t_contract_product_detail nn
							    WHERE trp.user_id = #currUserId#
								 AND trp.resource_type = 2 
								 AND tci.user_id = trp.target_user_id
								 AND tci.customer_code = cus.customer_code		    
								 AND nn.parent_tools_id = 'root' 
								 and length(nn.id) = 32	
								 AND nn.contract_infor_id = tci.id
								 <![CDATA[ AND IFNULL(nn.sum_arrival_amount,0)+IFNULL(nn.sum_out_amount,0) > IFNULL(nn.sum_delivery_amount,0)]]>
							    <isNotEmpty property="status" prepend="and">
							      <![CDATA[  tci.status = $status$ ]]>
							    </isNotEmpty>
							    <isNotEmpty property="contractCode" prepend="and">
							      <![CDATA[ tci.contract_code like '%$contractCode$%' ]]>
							    </isNotEmpty>
							    <isNotEmpty property="customerName" prepend="and">
							      <![CDATA[ tci.customer_name like '%$customerName$%' ]]>
							    </isNotEmpty>
							     <isNotEmpty property="startTime" prepend="and">
							      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
							    </isNotEmpty>
							     <isNotEmpty property="endTime" prepend="and">
							      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
							    </isNotEmpty>
							    <isNotEmpty property="year" prepend="and">
							      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y') = '$year$' ]]>
							    </isNotEmpty>
								<isNotEmpty property="sort" >
								order by $sort$ $dir$
								</isNotEmpty>
							GROUP BY tci.id
							limit $startIndex$,$pageSize$  
			) ct,t_contract_infor ccc
			WHERE ct.id = ccc.id
	  </isEqual>  
	   <isEqual property="conType" compareValue="orderOut" prepend="">
	   SELECT DISTINCT ccc.*,cus.lock_status cus_lock_status ,(SELECT COUNT(*) FROM t_accessories ac WHERE ac.business_id = ccc.id) file_count  FROM (
				SELECT abc.id,abc.contract_code,abc.con_detail_id,abc.detail_amount,
				SUM(aa.order_amount) order_amount,SUM(abc.out_amount) out_amount FROM (
				SELECT dd.*,cc.amount out_amount
				FROM (							 
				      SELECT tci.id,tci.contract_code,nn.id con_detail_id, IFNULL(nn.amount,0) detail_amount
				      FROM t_contract_infor tci,t_resource_purview trp,t_contract_product_detail nn
							       WHERE trp.user_id = #currUserId#
									 AND trp.resource_type = 2 
									 AND tci.user_id = trp.target_user_id	    
									 AND nn.parent_tools_id = 'root' 
							    <isNotEmpty property="leaf" prepend="and">
									 nn.leaf = #leaf#
							    </isNotEmpty>
									 AND nn.contract_infor_id = tci.id
									 AND tci.status = 4
									 and length(nn.id) = 32	
								<![CDATA[ AND nn.amount > IFNULL(nn.sum_order_amount,0)+IFNULL(nn.sum_out_amount,0)]]>
								<isNotEmpty property="status" prepend="and">
								<![CDATA[  tci.status = $status$ ]]>
								</isNotEmpty>
								<isNotEmpty property="contractCode" prepend="and">
								<![CDATA[ tci.contract_code like '%$contractCode$%' ]]>
								</isNotEmpty>
								<isNotEmpty property="customerName" prepend="and">
								<![CDATA[ tci.customer_name like '%$customerName$%' ]]>
								</isNotEmpty>
								<isNotEmpty property="startTime" prepend="and">
								<![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
								</isNotEmpty>
								<isNotEmpty property="endTime" prepend="and">
								<![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
								</isNotEmpty>
								 <isNotEmpty property="year" prepend="and">
							      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y') = '$year$' ]]>
							    </isNotEmpty>
				) dd LEFT JOIN  (
				SELECT osi.contract_product_detail_id,osi.amount FROM t_out_stock_infor oi,t_out_stock_detail osi WHERE osi.out_stock_infor_id = oi.id AND oi.out_Stock_Type in (1,5,6) 
				) cc 
				ON dd.con_detail_id = cc.contract_product_detail_id
				) abc 
				LEFT JOIN t_order_detail  aa
				ON abc.con_detail_id = aa.contract_product_detail_id
				GROUP BY abc.con_detail_id
			) ct,t_contract_infor ccc,t_customers_infor cus
			WHERE ct.id = ccc.id 
			AND ccc.customer_code = cus.customer_code
			<![CDATA[ AND ct.detail_amount > IFNULL(ct.order_amount,0) + IFNULL(ct.out_amount,0)]]>
			ORDER BY ccc.contract_code DESC 
			limit $startIndex$,$pageSize$  
	    </isEqual>  
  </select>
<!-- ?????????????count -->
    <select id="getContractListCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
			<isEqual property="conType" compareValue="delivery" prepend="">
			SELECT COUNT(*) FROM (
					SELECT tci.id, cus.lock_status cus_lock_status
					FROM t_contract_infor tci,t_resource_purview trp,t_customers_infor cus,t_contract_product_detail nn
							    WHERE trp.user_id = #currUserId#
								 AND trp.resource_type = 2 
								 AND tci.user_id = trp.target_user_id
								 AND tci.customer_code = cus.customer_code		    
								 AND nn.parent_tools_id = 'root' 
								 AND nn.contract_infor_id = tci.id
								 and length(nn.id) = 32	
								  <![CDATA[ AND IFNULL(nn.sum_arrival_amount,0)+IFNULL(nn.sum_out_amount,0) > IFNULL(nn.sum_delivery_amount,0)]]>
							    <isNotEmpty property="status" prepend="and">
							      <![CDATA[  tci.status = $status$ ]]>
							    </isNotEmpty>
							    <isNotEmpty property="contractCode" prepend="and">
							      <![CDATA[ tci.contract_code like '%$contractCode$%' ]]>
							    </isNotEmpty>
							    <isNotEmpty property="customerName" prepend="and">
							      <![CDATA[ tci.customer_name like '%$customerName$%' ]]>
							    </isNotEmpty>
							     <isNotEmpty property="startTime" prepend="and">
							      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
							    </isNotEmpty>
							     <isNotEmpty property="endTime" prepend="and">
							      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
							    </isNotEmpty>
								<isNotEmpty property="sort" >
								order by $sort$ $dir$
								</isNotEmpty>
							GROUP BY tci.id
			) ct
			</isEqual>
			 <isEqual property="conType" compareValue="orderOut" prepend="">
			SELECT count(DISTINCT ct.contract_code) 'count(*)' FROM (
				SELECT abc.id,abc.contract_code,abc.con_detail_id,abc.detail_amount,
				SUM(aa.order_amount) order_amount,SUM(abc.out_amount) out_amount FROM (
				SELECT dd.*,cc.amount out_amount
				FROM (							 
				      SELECT tci.id,tci.contract_code,nn.id con_detail_id, IFNULL(nn.amount,0) detail_amount
				      FROM t_contract_infor tci,t_resource_purview trp,t_contract_product_detail nn
							       WHERE trp.user_id = #currUserId#
									 AND trp.resource_type = 2 
									 AND tci.user_id = trp.target_user_id	    
									 AND nn.parent_tools_id = 'root' 
									 <isNotEmpty property="leaf" prepend="and">
									 nn.leaf = #leaf#
							    	 </isNotEmpty>
									 AND nn.contract_infor_id = tci.id
									 AND tci.status = 4	
									 and length(nn.id) = 32	
							    <![CDATA[ AND nn.amount > IFNULL(nn.sum_order_amount,0)+IFNULL(nn.sum_out_amount,0)]]>
								<isNotEmpty property="status" prepend="and">
								<![CDATA[  tci.status = $status$ ]]>
								</isNotEmpty>
								<isNotEmpty property="contractCode" prepend="and">
								<![CDATA[ tci.contract_code like '%$contractCode$%' ]]>
								</isNotEmpty>
								<isNotEmpty property="customerName" prepend="and">
								<![CDATA[ tci.customer_name like '%$customerName$%' ]]>
								</isNotEmpty>
								<isNotEmpty property="startTime" prepend="and">
								<![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
								</isNotEmpty>
								<isNotEmpty property="endTime" prepend="and">
								<![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
								</isNotEmpty>
								
				) dd LEFT JOIN (
				    SELECT osi.contract_product_detail_id,osi.amount FROM t_out_stock_infor oi,t_out_stock_detail osi WHERE osi.out_stock_infor_id = oi.id AND oi.out_Stock_Type in (1,5,6) 
				) cc 
				ON dd.con_detail_id = cc.contract_product_detail_id
				) abc 
				LEFT JOIN t_order_detail  aa
				ON abc.con_detail_id = aa.contract_product_detail_id
				GROUP BY abc.con_detail_id
			) ct
			WHERE 
			<![CDATA[ ct.detail_amount > IFNULL(ct.order_amount,0) + IFNULL(ct.out_amount,0)]]>
			</isEqual>
	    
  </select>
  
  
    <!-- 合同列表(加工品订单) -->
    <select id="getPOrderContractList" parameterClass="java.util.Map" resultClass="java.util.List" resultMap="result">
    SELECT DISTINCT ccc.*,cus.lock_status cus_lock_status,(SELECT COUNT(*) FROM t_accessories ac WHERE ac.business_id = ccc.id) file_count  FROM (
				SELECT abc.id,abc.contract_code,abc.detail_id,abc.detail_amount,
				SUM(aa.order_amount) order_amount,SUM(abc.out_amount) out_amount FROM (
					SELECT dd.*,cc.amount out_amount
					FROM (							 
							SELECT tci.id,tci.contract_code, IFNULL(nn.amount,0) detail_amount ,nn.id detail_id
							FROM t_contract_infor tci,t_resource_purview trp,t_contract_product_detail nn
									    WHERE trp.user_id = #currUserId#
										 AND trp.resource_type = 2 
										 AND tci.user_id = trp.target_user_id	    
										 AND nn.parent_tools_id = 'root' 
										 AND nn.leaf = 0
										 AND nn.contract_infor_id = tci.id
										 AND tci.status = 4
										 and length(nn.id) = 32	
										 <![CDATA[ AND nn.amount > IFNULL(nn.sum_order_amount,0)]]>
									     <isNotEmpty property="status" prepend="and">
									      <![CDATA[  tci.status = $status$ ]]>
									    </isNotEmpty>
									    <isNotEmpty property="contractCode" prepend="and">
									      <![CDATA[ tci.contract_code like '%$contractCode$%' ]]>
									    </isNotEmpty>
									    <isNotEmpty property="customerName" prepend="and">
									      <![CDATA[ tci.customer_name like '%$customerName$%' ]]>
									    </isNotEmpty>
									     <isNotEmpty property="startTime" prepend="and">
									      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
									    </isNotEmpty>
									     <isNotEmpty property="endTime" prepend="and">
									      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
									    </isNotEmpty>
										
					) dd LEFT JOIN 
					(SELECT osi.contract_product_detail_id,osi.amount FROM t_out_stock_infor oi,t_out_stock_detail osi WHERE osi.out_stock_infor_id = oi.id AND oi.out_Stock_Type = 1) cc
					ON dd.detail_id = cc.contract_product_detail_id
				) abc LEFT JOIN  t_order_detail aa
				ON abc.detail_id = aa.contract_product_detail_id
				GROUP BY abc.detail_id

			) ct,t_contract_infor ccc,t_customers_infor cus
			
			WHERE ct.id = ccc.id
			AND ccc.customer_code = cus.customer_code
			<![CDATA[AND ct.detail_amount > IFNULL(ct.order_amount,0) + IFNULL(ct.out_amount,0)]]>
			ORDER BY ccc.contract_code DESC
			limit $startIndex$,$pageSize$ 
  </select>
<!-- 合同列表数量(加工品订单) -->
    <select id="getPOrderContractListCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
 	
SELECT COUNT(DISTINCT ct.id) FROM (
				SELECT abc.id,abc.contract_code,abc.detail_id,abc.detail_amount,
				SUM(aa.order_amount) order_amount,SUM(abc.out_amount) out_amount FROM (
					SELECT dd.*,cc.amount out_amount
					FROM (							 
							SELECT tci.id,tci.contract_code, IFNULL(nn.amount,0) detail_amount ,nn.id detail_id
							FROM t_contract_infor tci,t_resource_purview trp,t_contract_product_detail nn
									    WHERE trp.user_id = #currUserId#
										 AND trp.resource_type = 2 
										 AND tci.user_id = trp.target_user_id	    
										 AND nn.parent_tools_id = 'root' 
										 AND nn.leaf = 0
										 AND nn.contract_infor_id = tci.id
										 AND tci.status = 4
										 and length(nn.id) = 32	
										 <![CDATA[ AND nn.amount > IFNULL(nn.sum_order_amount,0)]]>
									     <isNotEmpty property="status" prepend="and">
									      <![CDATA[  tci.status = $status$ ]]>
									    </isNotEmpty>
									    <isNotEmpty property="contractCode" prepend="and">
									      <![CDATA[ tci.contract_code like '%$contractCode$%' ]]>
									    </isNotEmpty>
									    <isNotEmpty property="customerName" prepend="and">
									      <![CDATA[ tci.customer_name like '%$customerName$%' ]]>
									    </isNotEmpty>
									     <isNotEmpty property="startTime" prepend="and">
									      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
									    </isNotEmpty>
									     <isNotEmpty property="endTime" prepend="and">
									      <![CDATA[ DATE_FORMAT(tci.edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
									    </isNotEmpty>
										
					) dd LEFT JOIN 
					(SELECT osi.contract_product_detail_id,osi.amount FROM t_out_stock_infor oi,t_out_stock_detail osi WHERE osi.out_stock_infor_id = oi.id AND oi.out_Stock_Type = 1) cc
					ON dd.detail_id = cc.contract_product_detail_id
				) abc LEFT JOIN  t_order_detail aa
				ON abc.detail_id = aa.contract_product_detail_id
				GROUP BY abc.detail_id

			) ct
			WHERE 
			<![CDATA[ct.detail_amount > IFNULL(ct.order_amount,0) + IFNULL(ct.out_amount,0)]]>
  </select>
  
  <select id="findContractList" parameterClass="java.util.Map" resultClass="java.util.List" resultMap="ibatorgenerated_BaseResultMap">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 14 14:13:27 CST 2009.
    -->
    select id, contract_code, seller_name, currency_name, sign_date, urgent_level, customer_code,
      customer_name, status, sign_address, reference, traffic_mode, closing_account_mode_id,
      closing_account_mode, delivery_address_type, other_convention, effect_conditions,
      product_money, tax_rate, tax_money, total_money, overall_rebate, final_money, memo, edit_date,
      user_id, user_name,contract_type, customer_fax, customer_phone, own_contact_person,
      cus_contact_person,exemplar_invoice,invoice_money,return_money,delivery_money
    from t_contract_infor
   where (status = 2 or status = 4)
    <isNotEmpty property="contractCode" prepend="and">
      <![CDATA[ contract_code like '%$contractCode$%' ]]>
    </isNotEmpty>
    <isNotEmpty property="customerName" prepend="and">
      <![CDATA[ customer_name like '%$customerName$%' ]]>
    </isNotEmpty>
     <isNotEmpty property="startTime" prepend="and">
      <![CDATA[ DATE_FORMAT(edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
    </isNotEmpty>
     <isNotEmpty property="endTime" prepend="and">
      <![CDATA[ DATE_FORMAT(edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
    </isNotEmpty>
    	order by edit_date desc
    <isNotEmpty property="startIndex" >
        limit $startIndex$,$pageSize$
    </isNotEmpty>
    </select>
    
    
    <select id="findContractListCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    <!--
      WARNING - This element is automatically generated by Apache iBATIS ibator, do not modify.
      This element was generated on Wed Oct 14 14:13:27 CST 2009.
    -->
    select count(*)
    from t_contract_infor
    where (status = 2 or status = 4)
      <isNotEmpty property="contractCode" prepend="and">
      <![CDATA[ contract_code like '%$contractCode$%' ]]>
    </isNotEmpty>
    <isNotEmpty property="customerName" prepend="and">
      <![CDATA[ customer_name like '%$customerName$%' ]]>
    </isNotEmpty>
     <isNotEmpty property="startTime" prepend="and">
      <![CDATA[ DATE_FORMAT(edit_date,'%Y-%m-%d') >= '$startTime$' ]]>
    </isNotEmpty>
     <isNotEmpty property="endTime" prepend="and">
      <![CDATA[ DATE_FORMAT(edit_date,'%Y-%m-%d') <= '$endTime$' ]]>
    </isNotEmpty>
  </select>
  <select id="getContractNeedDeliveryAmount" parameterClass="string" resultClass="java.math.BigDecimal">
     SELECT (SUM(IFNULL(pd.amount,0)) - SUM(IFNULL(pd.sum_delivery_amount,0))) amount 
	 FROM t_contract_product_detail pd 
	 WHERE pd.contract_infor_id = #value#
  </select>
  <select id="findWaitOrderContractCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		    select count(distinct id) from (
				select cc.* from (
							select aa.*,ifnull(bb.order_amount,0) order_amount from (
								select sum(cpd.amount) amount,ci.contract_code,ci.id,ci.user_id from t_contract_product_detail cpd,t_contract_infor ci 
								where cpd.contract_infor_id = ci.id 
								and cpd.parent_tools_id = 'root'
								and cpd.leaf = 1
								AND ci.status = 4
								group by id
							) aa left join (
								select sum(od.order_amount) order_amount,oi.contract_code from t_order_detail od,t_order_infor oi
								where od.stock_order_infor_id = oi.id
								and oi.contract_code is not null
								and oi.order_type = 1
								group by contract_code
							) bb on aa.contract_code = bb.contract_code
						) cc left join (
							select sum(osd.amount) out_amount,osi.contract_code from t_out_stock_infor osi,t_out_stock_detail osd 
							where osi.id = osd.out_stock_infor_id
							and osi.out_stock_type = 1
							group by contract_code
						) dd
						on cc.contract_code = dd.contract_code
						where cc.amount > cc.order_amount + ifnull(dd.out_amount,0)
				) abc,(select rp.target_user_id from t_resource_purview rp where rp.user_id = #userId# and rp.resource_type = 2) efg
				where abc.user_id = efg.target_user_id
  </select>
  <select id="findWaitOrderContract" parameterClass="java.util.Map" resultClass="java.util.HashMap">
		select distinct abc.* from (
			select cc.* from (
						select aa.*,ifnull(bb.order_amount,0) order_amount from (
							select sum(cpd.amount) amount,ci.contract_code,ci.id,ci.user_id from t_contract_product_detail cpd,t_contract_infor ci 
							where cpd.contract_infor_id = ci.id 
							and cpd.parent_tools_id = 'root'
							and cpd.leaf = 1
							AND ci.status = 4
							group by id
						) aa left join (
							select sum(od.order_amount) order_amount,oi.contract_code from t_order_detail od,t_order_infor oi
							where od.stock_order_infor_id = oi.id
							and oi.contract_code is not null
							and oi.order_type = 1
							group by contract_code
						) bb on aa.contract_code = bb.contract_code
					) cc left join (
						select sum(osd.amount) out_amount,osi.contract_code from t_out_stock_infor osi,t_out_stock_detail osd 
						where osi.id = osd.out_stock_infor_id
						and osi.out_stock_type =1
						group by contract_code
					) dd
					on cc.contract_code = dd.contract_code
					where cc.amount > cc.order_amount + ifnull(dd.out_amount,0)
			) abc,(select rp.target_user_id from t_resource_purview rp where rp.user_id = #userId#) efg
			where abc.user_id = efg.target_user_id
			order by id desc
			limit #startIndex#,#pageSize#
  </select>
  
  <!-- 根据编号查找合同(ftl 2010-01-08) -->
  <select id="getContractByCode" parameterClass="String" resultClass="com.tl.resource.dao.pojo.TContractInfor" resultMap="ibatorgenerated_BaseResultMap">
    <![CDATA[
      select * from t_contract_infor t where t.contract_code=#value#
    ]]>
  </select>

 <select id="getContractCountCouldUploadFile" parameterClass="java.util.Map" resultClass="java.lang.Integer">
    SELECT COUNT(DISTINCT ci.id) FROM (
	SELECT tt.* FROM t_contract_infor tt,t_customers_infor cus 
		WHERE tt.customer_code = cus.customer_code
		AND (tt.user_id = #userId# or cus.own_contact_person_id = #userId#) 
		and tt.status not in (0,-1,5)
	) ci LEFT JOIN t_accessories ac
	ON ci.id = ac.business_id
	WHERE ac.id IS NULL
 </select>
  <select id="getContractMonthMoneys" parameterClass="java.util.Map" resultClass="java.util.HashMap">
    SELECT SUM(final_money) visits,DATE_FORMAT(edit_date,'%y-%m') NAME
	FROM t_contract_infor ci 
	WHERE ci.status IN (2,4,5)
	<isNotEmpty property="startTime" prepend="and">
	<![CDATA[ DATE_FORMAT(edit_date,'%Y-%m') >= #startTime#]]>
	</isNotEmpty>
	<isNotEmpty property="endTime" prepend="and">
	<![CDATA[ DATE_FORMAT(edit_date,'%Y-%m') <= #endTime#]]>
	</isNotEmpty>
	<isNotEmpty property="customerName" prepend="and">
	<![CDATA[ customer_name = #customerName#]]>
	</isNotEmpty>
	<isNotEmpty property="ownContactPerson" prepend="and">
	<![CDATA[ own_contact_person = #ownContactPerson#]]>
	</isNotEmpty>
	GROUP BY DATE_FORMAT(edit_date,'%y-%m')
 </select>
  <select id="getContractMoneysForOwnPerson" parameterClass="java.util.Map" resultClass="java.util.HashMap">
  	SELECT SUM(i.final_money) money,
	i.own_contact_person,
	SUM(IFNULL(a.money,0)) h_money
	 FROM t_contract_infor i LEFT JOIN 
	(
	SELECT SUM(ca.money) money,ca.contract_infor_id
	FROM t_contract_accounts_infor ca,t_contract_infor ci
	WHERE ca.contract_infor_id = ci.id
	<isNotEmpty property="startTime" prepend="and">
	<![CDATA[ DATE_FORMAT(ci.edit_date,'%Y-%m') >= #startTime#]]>
	</isNotEmpty>
	<isNotEmpty property="endTime" prepend="and">
	<![CDATA[ DATE_FORMAT(ci.edit_date,'%Y-%m') <= #endTime#]]>
	</isNotEmpty>
	GROUP BY ca.contract_infor_id
	) a 
	ON i.id = a.contract_infor_id
	WHERE i.status IN (2,4,5)
	<isNotEmpty property="startTime" prepend="and">
	<![CDATA[ DATE_FORMAT(i.edit_date,'%Y-%m') >= #startTime#]]>
	</isNotEmpty>
	<isNotEmpty property="endTime" prepend="and">
	<![CDATA[ DATE_FORMAT(i.edit_date,'%Y-%m') <= #endTime#]]>
	</isNotEmpty>
	GROUP BY i.own_contact_person
  </select>
  
	<procedure id="checkSetContractOver" parameterClass="String">
       { call check_set_contract_over(#value#) } 
	</procedure>
	<procedure id="relationScheduleInfor" parameterClass="String">
       { call contract_rela_try_tools_or_schedule_infor(#value#) } 
	</procedure>
	
  <select id="getSumContractMoneyByCustomerCode" parameterClass="string" resultClass="java.math.BigDecimal">
     SELECT ifnull(SUM(ci.final_money),0) money
     FROM t_contract_infor ci 
     WHERE ci.status in ( 4,5)  and ci.customer_code = #value#
  </select>
	
<update id="updateContractInvoiceStatus">
	UPDATE t_contract_infor SET invoice_status = #v# WHERE id = #conId#
</update>
<update id="updateContractAccountMoney" parameterClass="string">
	UPDATE t_contract_infor SET return_money = (select sum(acc.money) contract_money from t_contract_accounts_infor acc where acc.contract_infor_id =  #conId#) WHERE id = #conId#
</update>
<update id="updateContractInvoiceMoney" parameterClass="string">
	UPDATE t_contract_infor SET invoice_money = (select sum(ivd.money) inv_money from t_invoice_detail ivd,t_invoice_info iv where iv.id = ivd.invoice_info_id and iv.contract_id =  #conId#) WHERE id = #conId#
</update>
<update id="updateContracDelieryMoney" parameterClass="string">
	UPDATE t_contract_infor SET delivery_money = (SELECT SUM(IFNULL(sum_delivery_amount,0)*tax_net_price) FROM t_contract_product_detail WHERE contract_infor_id =  #conId#) WHERE id = #conId#
</update>

</sqlMap>